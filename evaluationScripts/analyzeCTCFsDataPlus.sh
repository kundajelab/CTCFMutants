# Find all occurrences of the core+downstream in biotin-tagged CTCF peaks
zcat /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz | fastaFromBed -fi /srv/scratch/imk1/TFBindingPredictionProject/HumanGenome/hg38.fa -bed stdin -fo /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.fa
fasta-get-markov -m 1 -dna /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.fa /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.background
fimo --max-stored-scores 50000000 --bgfile /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.background --motif CoreDownstream --o /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits --thresh 1 /srv/scratch/imk1/TFBindingPredictionProject/MouseMutantData/newTFModiscoMotifCombinations.meme /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.fa

# Compare occurrences of core+downstream motif in CTCF peaks overlapping CTCF-s peaks to CTCF peaks not overlapping CTCF peaks
intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz -b /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCF-sPeak/peak/spp/idr/optimal_set/CTCF-sPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz > /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz -b /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCF-sPeak/peak/spp/rep1/SRR8180977_1.PE2SE.nodup.tagAlign_x_SRR8180975_1.PE2SE.nodup.tagAlign.filt.regionPeak.gz > /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs.bed
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs_bestCoreDownstreampVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs_bestCoreDownstreampVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inEncodeHela.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inEncodeHela_bestCoreDownstreampVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInEncodeHela.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInEncodeHela_bestCoreDownstreampVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/makeViolinPlotsCoreDownstreamCTCFs.py

# Get downstream motif strengths within core + downstream motif hits in CTCF peaks
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/convertFIMOToMotifHitBed.py --fimoFileName /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo.txt --scoreCol 5 --qValCutoff 0.05 --outputFileName /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.bed
fastaFromBed -fi /srv/scratch/imk1/TFBindingPredictionProject/HumanGenome/hg38.fa -bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.bed -fo /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.fa
fimo --max-stored-scores 50000000 --bgfile /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.background --motif Downstream --o /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.FIMODownstreamHits --thresh 1 /srv/scratch/imk1/TFBindingPredictionProject/MouseMutantData/newTFModiscoMotifCombinations.meme /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.fa
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.FIMODownstreamHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs_bestDownstreampVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHits/fimo_CoreDownstream_qVal.05.FIMODownstreamHits/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs_bestDownstreampVal.txt

# Find all occurrences of the core in biotin-tagged CTCF peaks
fimo --max-stored-scores 50000000 --bgfile /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.background --motif Core --o /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHitsCore --thresh 1 /srv/scratch/imk1/TFBindingPredictionProject/MouseMutantData/newTFModiscoMotifCombinations.meme /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.fa
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHitsCore/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inCTCFs_bestCorepVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHitsCore/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInCTCFs_bestCorepVal.txt
intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz -b /srv/scratch/imk1/TFBindingPredictionProject/EncodeCTCFData/ENCFF772LNY.bed.gz > /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inEncodeHela.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.narrowPeak.gz -b /srv/scratch/imk1/TFBindingPredictionProject/EncodeCTCFData/ENCFF331BAX.bed.gz > /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInEncodeHela.bed
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHitsCore/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inEncodeHela.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_inEncodeHela_bestCorepVal.txt
python /srv/scratch/imk1/TFBindingPredictionProject/src/IMKTFBindingCode/getBestFIMOBed.py /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt.FIMOResultsNewTFMoDIScoAllHitsCore/fimo.txt /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInEncodeHela.bed /srv/scratch/imk1/TFBindingPredictionProject/CTCF-sData/biotin/CTCFPeak/peak/spp/idr/optimal_set/CTCFPeak_rep1-pr.IDR0.05.filt_notInEncodeHela_bestCorepVal.txt

