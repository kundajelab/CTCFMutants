# Get the motif hits in the Myers Lab 14.5 day liver data
fastaFromBed -fi /srv/scratch/imk1/TFBindingPredictionProject/MouseGenome/mm10_no_alt_analysis_set_ENCODE.fasta -bed /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -fo /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.fa
fasta-get-markov -m 1 -dna /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.fa /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.background
fimo --bgfile /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.background --o /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs /srv/scratch/imk1/TFBindingPredictionProject/MouseMutantData/newTFModiscoMotifCombinations.meme /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.fa
python /srv/scratch/imk1/TFBindingPredictionProject/src/RegElEvoCode/convertFIMOToMotifHitBed.py --nameCol 0 --fimoFileName /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.txt --pValCutoff 0.0001 --outputFileName /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed

# Get regions with groups of motifs that have the same sub-motif
awk 'BEGIN{OFS="\t"} $4=="Core"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreMotifNewTFModisco.bed
awk 'BEGIN{OFS="\t"} $4=="Upstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamMotifNewTFModisco.bed
awk 'BEGIN{OFS="\t"} $4=="Downstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_downstreamMotifNewTFModisco.bed # Empty file
awk 'BEGIN{OFS="\t"} $4=="UpstreamCore"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed
awk 'BEGIN{OFS="\t"} $4=="CoreDownstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed
awk 'BEGIN{OFS="\t"} $4=="UpstreamCoreDownstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -u -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreMotifNewTFModisco.bed -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreOnlyMotifNewTFModisco.bed
cat /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamMotifNewTFModisco.bed /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamNoDownstreamMotifNewTFModisco.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_downstreamNoUpstreamMotifNewTFModisco.bed
cat /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_corePlusMotifNewTFModisco.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreMotifNewTFModisco.bed -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreNoUpstreamMotifNewTFModisco.bed
subtractBed -A -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreMotifNewTFModisco.bed -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreDownstreamMotifNewTFModisco.bed | subtractBed -A -a stdin -b /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_upstreamCoreDownstreamMotifNewTFModisco.bed | sort -u -k1,1 -k2,2n -k3,3n -k10,10n > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_coreNoDownstreamMotifNewTFModisco.bed

# Compare the occurrences of the different types of motifs to the peak height
awk 'BEGIN{OFS="\t"} $4=="Core"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -wb -loj -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin | sort -k15,15nr | sort -u -k1,1 -k2,2n -k3,3n -k10,10n | cut -f1,2,3,10,7,15 | sed 's/-1/0/g' > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_signalVsCoreNewTFModiscoMotifScore.bed
awk 'BEGIN{OFS="\t"} $4=="Upstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -wb -loj -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin | sort -k15,15nr | sort -u -k1,1 -k2,2n -k3,3n -k10,10n | cut -f1,2,3,10,7,15 | sed 's/-1/0/g' > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_signalVsUpstreamNewTFModiscoMotifScore.bed
# No Downstream only motif hits
awk 'BEGIN{OFS="\t"} $4=="UpstreamCore"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -wb -loj -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin | sort -k15,15nr | sort -u -k1,1 -k2,2n -k3,3n -k10,10n | cut -f1,2,3,10,7,15 | sed 's/-1/0/g' > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_signalVsUpstreamCoreNewTFModiscoMotifScore.bed
awk 'BEGIN{OFS="\t"} $4=="CoreDownstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -wb -loj -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin | sort -k15,15nr | sort -u -k1,1 -k2,2n -k3,3n -k10,10n | cut -f1,2,3,10,7,15 | sed 's/-1/0/g' > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_signalVsCoreDownstreamNewTFModiscoMotifScore.bed
awk 'BEGIN{OFS="\t"} $4=="UpstreamCoreDownstream"' /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.FIMOResultsNewTFModiscoMotifs/fimo.bed | intersectBed -wa -wb -loj -a /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W.narrowPeak.gz -b stdin | sort -k15,15nr | sort -u -k1,1 -k2,2n -k3,3n -k10,10n | cut -f1,2,3,10,7,15 | sed 's/-1/0/g' > /srv/scratch/imk1/TFBindingPredictionProject/MouseCohesinData/Ctcf_Heart_Ren_8W_signalVsUpstreamCoreDownstreamNewTFModiscoMotifScore.bed
